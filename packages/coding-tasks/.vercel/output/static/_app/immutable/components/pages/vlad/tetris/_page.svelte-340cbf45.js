import{S as Z,i as V,s as J,k as p,q as y,a as _,l as u,m as x,r as C,h as f,c as A,n as w,b as K,G as l,B as L,o as U}from"../../../../chunks/index-1664d19c.js";const M=(t,h,e,o,n,s,i,a=1)=>{a!==1&&(t.globalAlpha=a),t.beginPath(),s&&(t.fillStyle=s,t.fillRect(h,e,o,n)),t.rect(h,e,o,n),t.lineWidth=s&&i||1,t.stroke(),t.closePath(),t.globalAlpha!==1&&(t.globalAlpha=1)},Y=(t,h)=>{const e=document.getElementById("canvas");e.width=t,e.height=h;const o=e.getContext("2d");return{canvas:e,context:o}},$="teteris-high-score";function Q(t,h,e){this.context=t,this.infoWidthPx=h,this.fieldWidthPx=e,this.currentScore=0,this.highScore=+(localStorage.getItem($)||0),this.nextShape=null,this.draw=()=>{this.context.clearRect(this.fieldWidthPx,0,this.infoWidthPx,this.context.canvas.clientHeight),M(this.context,this.fieldWidthPx,0,this.infoWidthPx,this.context.canvas.clientHeight,void 0,2),this.drawCurrentScore(),this.drawHighScore(),this.drawNextShape()},this.setNextShape=o=>{this.nextShape=o},this.drawScore=(o,n,s)=>{this.context.font=`${24}px Courier`,this.context.fillStyle="black",this.context.fillText(`${n}:`,this.fieldWidthPx+10,24*s),this.context.fillText(o,this.fieldWidthPx+10,24*(s+1))},this.drawCurrentScore=()=>this.drawScore(this.currentScore,"Score",1),this.drawHighScore=()=>this.drawScore(this.highScore,"High score",3),this.drawNextShape=()=>{this.drawScore("","Next shape",6),this.nextShape.draw(1,{x:this.fieldWidthPx+10,y:160},!1)},this.addScore=o=>{this.currentScore+=o,this.currentScore>this.highScore&&(this.highScore=this.currentScore,localStorage.setItem($,this.highScore))}}const X=t=>Math.floor(Math.random()*t),O=t=>new Promise(h=>setTimeout(h,t)),tt=t=>t[0].map((h,e)=>t.map(o=>o[e])),et=t=>tt(t.reverse()),st=(t,h)=>t.length===h.length&&t.every((e,o)=>e===h[o]),it=(t,h)=>t.length===h.length&&t.every((e,o)=>st(e,h[o]));function g(t,h,e,o,n=[]){this.context=t,this.cellSizePx=e,this.cells=n,this.offset=h||{x:0,y:0},this.color=o,this.width=()=>this.cells[0].length,this.height=()=>this.cells.length,this.move=(s,i)=>{this.offset.x+=s,this.offset.y+=i},this.draw=(s,i,a=!0)=>{this.cells.forEach((r,c)=>r.forEach((S,z)=>{!a&&!S||M(this.context,this.offset.x*this.cellSizePx+z*this.cellSizePx+((i==null?void 0:i.x)||0),this.offset.y*this.cellSizePx+c*this.cellSizePx+((i==null?void 0:i.y)||0),this.cellSizePx,this.cellSizePx,S&&this.color,2,s)}))},this.toString=()=>this.cells.map(s=>s.join("|")).join(`
`),this.getBottomCoordinates=()=>{const s=[];for(let i=0;i<this.width();i++)for(let a=this.height()-1;a>=0;a--)if(this.cells[a][i]===1){s.push({x:i+this.offset.x,y:a+this.offset.y});break}return s},this.clone=()=>new g(this.context,{...this.offset},this.cellSizePx,this.color,this.cells.map(s=>[...s])),this.equals=s=>this.offset.x===s.offset.x&&this.offset.y===s.offset.y&&it(this.cells,s.cells),this.rotate=()=>{this.cells=et(this.cells)}}function ht(t,h,e){g.call(this,t,h,e,"cyan",[[1,1,1,1]])}function ot(t,h,e){g.call(this,t,h,e,"yellow",[[1,1],[1,1]])}function at(t,h,e){g.call(this,t,h,e,"red",[[0,1,1],[1,1,0]])}function lt(t,h,e){g.call(this,t,h,e,"green",[[1,1,0],[0,1,1]])}function nt(t,h,e){g.call(this,t,h,e,"purple",[[0,1,0],[1,1,1]])}function rt(t,h,e){g.call(this,t,h,e,"orange",[[0,0,1],[1,1,1]])}function ct(t,h,e){g.call(this,t,h,e,"pink",[[1,0,0],[1,1,1]])}const dt=[ht,ot,at,lt,nt,rt,ct];function St(t,h){this.context=t,this.shapes=dt,this.getRandomShape=()=>{const e=X(this.shapes.length),o=this.shapes[e];return new o(this.context,{x:0,y:0},h)}}function ft(t,h,e,o,n){this.context=t,this.widthPx=h,this.heightPx=e,this.cellSizePx=o,this.shapes=new St(this.context,this.cellSizePx),this.info=new Q(this.context,n,this.widthPx),this.width=Math.floor(this.widthPx/this.cellSizePx),this.height=Math.floor(this.heightPx/this.cellSizePx),this.currentShape=null,this.shadow=null,this.cells=new Array(this.height).fill(1).map(()=>new Array(this.width).fill(0)),this.initialize=()=>{this.info.setNextShape(this.shapes.getRandomShape()),this.setNewShape()},this.setNewShape=()=>{this.setCurrentShape(this.info.nextShape.clone()),this.info.setNextShape(this.shapes.getRandomShape())},this.draw=()=>{this.context.clearRect(0,0,this.widthPx,this.heightPx),this.cells.forEach((s,i)=>s.forEach((a,r)=>{M(this.context,r*this.cellSizePx,i*this.cellSizePx,this.cellSizePx,this.cellSizePx,a,2)})),this.currentShape.draw(),this.drawShadow(),this.info.draw()},this.update=()=>{this.moveCurrentShape(0,1);let s=0;for(let i=this.height-1;i>=0;i--)if(this.cells[i].every(Boolean)){s++;for(let a=i;a>0;a--)this.cells[a]=[...this.cells[a-1]];i=this.height-1}if(s>0){const i={1:200,2:500,3:750,4:1e3};this.info.addScore(i[s])}s=0},this.toString=()=>this.cells.map(s=>s.map(i=>i?1:0).join("|")).join(`
`),this.setCurrentShape=s=>{this.currentShape=s,this.currentShape.move(Math.floor(this.width/2)-1,0)},this.drawShadow=()=>{this.shadow=this.getShapeAtTheBottom(this.currentShape),this.shadow.draw(.25)},this.getShapeAtTheBottom=s=>{const i=s.clone();let a=!0;do a=i.getBottomCoordinates().every(({x:c,y:S})=>this.cells[S+1]&&this.cells[S+1][c]===0),a&&i.move(0,1);while(a);return i},this.addShape=s=>{const i=this.getShapeAtTheBottom(s);i.cells.forEach((a,r)=>a.forEach((c,S)=>{c&&(this.cells[r+i.offset.y][S+i.offset.x]=i.color)}))},this.placeCurrentShape=()=>{this.addShape(this.currentShape),this.setNewShape()},this.moveCurrentShape=(s=0,i=0)=>{s&&this.currentShape.offset.x+s>=0&&this.currentShape.offset.x+this.currentShape.width()+s<=this.width&&this.currentShape.move(s,0),i&&this.currentShape.move(0,i),this.currentShape.equals(this.shadow)&&this.placeCurrentShape()},this.rotateCurrentShape=()=>{this.currentShape.rotate()}}const pt=async()=>{const{context:n}=Y(500,500),s=new ft(n,300,500,20,200);for(s.initialize(),document.addEventListener("keydown",i=>{if(["ArrowRight","ArrowLeft"].includes(i.code)){const r=i.code.toLowerCase().replace("arrow","")==="right"?1:-1;s.moveCurrentShape(r)}["ArrowDown"].includes(i.code)&&s.moveCurrentShape(0,1),["ArrowUp"].includes(i.code)&&s.rotateCurrentShape(),["Space"].includes(i.code)&&s.placeCurrentShape()});;)s.draw(),s.update(),await O(300)};function ut(t){let h,e,o,n,s,i,a,r,c,S,z,m,I,N,P,W,R,v,D,b,T;return{c(){h=p("div"),e=p("h1"),o=p("span"),n=y("T"),s=_(),i=p("span"),a=y("E"),r=_(),c=p("span"),S=y("T"),z=_(),m=p("span"),I=y("R"),N=_(),P=p("span"),W=y("I"),R=_(),v=p("span"),D=y("S"),b=_(),T=p("canvas"),this.h()},l(H){h=u(H,"DIV",{class:!0});var E=x(h);e=u(E,"H1",{class:!0});var d=x(e);o=u(d,"SPAN",{class:!0});var B=x(o);n=C(B,"T"),B.forEach(f),s=A(d),i=u(d,"SPAN",{class:!0});var k=x(i);a=C(k,"E"),k.forEach(f),r=A(d),c=u(d,"SPAN",{class:!0});var q=x(c);S=C(q,"T"),q.forEach(f),z=A(d),m=u(d,"SPAN",{class:!0});var G=x(m);I=C(G,"R"),G.forEach(f),N=A(d),P=u(d,"SPAN",{class:!0});var j=x(P);W=C(j,"I"),j.forEach(f),R=A(d),v=u(d,"SPAN",{class:!0});var F=x(v);D=C(F,"S"),F.forEach(f),d.forEach(f),b=A(E),T=u(E,"CANVAS",{id:!0}),x(T).forEach(f),E.forEach(f),this.h()},h(){w(o,"class","red svelte-95f6lm"),w(i,"class","orange svelte-95f6lm"),w(c,"class","yellow svelte-95f6lm"),w(m,"class","green svelte-95f6lm"),w(P,"class","blue svelte-95f6lm"),w(v,"class","purple svelte-95f6lm"),w(e,"class","svelte-95f6lm"),w(T,"id","canvas"),w(h,"class","svelte-95f6lm")},m(H,E){K(H,h,E),l(h,e),l(e,o),l(o,n),l(e,s),l(e,i),l(i,a),l(e,r),l(e,c),l(c,S),l(e,z),l(e,m),l(m,I),l(e,N),l(e,P),l(P,W),l(e,R),l(e,v),l(v,D),l(h,b),l(h,T)},p:L,i:L,o:L,d(H){H&&f(h)}}}function xt(t){return U(pt),[]}class gt extends Z{constructor(h){super(),V(this,h,xt,ut,J,{})}}export{gt as default};
